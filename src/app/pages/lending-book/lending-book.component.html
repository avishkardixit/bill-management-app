<div class="lending-page">
  <h2>Lending Book</h2>

  <!-- Add party -->
  <div class="add-party">
    <button (click)="openAddPartyDialog()">Add Party</button>
  </div>

  <!-- Ledger table -->
  <table class="ledger">
    <thead>
      <tr>
        <th>Party</th>
        <th>Balance</th>
        <th>Actions</th>
      </tr>
    </thead>

    <tbody>
  <ng-container *ngFor="let p of parties">

    <!-- Main row -->
    <tr>
      <td>{{ p.partyName }}</td>
      <td>₹ {{ p.balance }}</td>
      <td>
        <button mat-stroked-button color="accent" (click)="select(p)">
          {{ selected?.id === p.id ? 'Hide History' : 'View History' }}
        </button>
        <button mat-stroked-button color="primary" (click)="addAmount(p)">
          Add Amount
        </button>
        <button mat-stroked-button color="accent" (click)="receiveAmount(p)">
          Received Amount
        </button>
        <button mat-stroked-button color="warn" (click)="delete(p.id)">
          Delete Entry
        </button>
      </td>
    </tr>

    <!-- History directly under selected row -->
    <tr *ngIf="selected?.id === p.id">
      <td colspan="3">
        <div class="history">
          <h3>Transactions – {{ selected.partyName }}</h3>

          <table>
            <tr>
              <th>Date</th>
              <th>Type</th>
              <th>Amount</th>
              <th>Reference</th>
            </tr>

            <tr *ngFor="let t of transactions">
              <td>{{ t.date | date: "short" }}</td>
              <td>{{ t.type }}</td>
              <td>₹ {{ t.amount }}</td>
              <td>{{ t.reference }}</td>
            </tr>
          </table>
        </div>
      </td>
    </tr>

  </ng-container>
</tbody>
</table>
</div>
